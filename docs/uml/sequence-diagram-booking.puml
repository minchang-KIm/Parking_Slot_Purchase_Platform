@startuml 예약_시퀀스_다이어그램

actor "사용자" as User
participant "프론트엔드" as Frontend
participant "백엔드 API" as Backend
participant "데이터베이스" as DB
participant "결제 시스템" as Payment

User -> Frontend: 주차공간 검색
Frontend -> Backend: GET /api/parking-spaces?lat=&lng=
Backend -> DB: 위치 기반 쿼리
DB --> Backend: 주차공간 목록
Backend --> Frontend: 검색 결과
Frontend --> User: 주차공간 표시

User -> Frontend: 주차공간 선택
Frontend -> Backend: GET /api/parking-spaces/:id
Backend -> DB: 주차공간 조회
DB --> Backend: 주차공간 상세 정보
Backend --> Frontend: 상세 정보
Frontend --> User: 상세 페이지 표시

User -> Frontend: 예약 정보 입력\n(시간, 차량번호)
Frontend -> Frontend: 유효성 검증

Frontend -> Backend: POST /api/bookings\n{parkingSpace, startTime, endTime, vehicleInfo}
Backend -> Backend: 토큰 검증
Backend -> DB: 예약 중복 확인
DB --> Backend: 가능 여부

alt 예약 가능
  Backend -> DB: 예약 생성
  DB --> Backend: 예약 정보
  Backend --> Frontend: 201 Created
  Frontend --> User: 예약 성공 메시지

  User -> Frontend: 결제 진행
  Frontend -> Backend: POST /api/payments\n{bookingId, paymentMethod}
  Backend -> DB: 결제 정보 생성
  Backend -> Payment: 결제 요청
  Payment --> Backend: 결제 승인
  Backend -> DB: 결제 완료 업데이트
  Backend -> DB: 예약 상태 업데이트
  Backend --> Frontend: 결제 완료
  Frontend --> User: 결제 성공 알림

else 예약 불가능
  Backend --> Frontend: 400 Bad Request
  Frontend --> User: 예약 불가 알림
end

@enduml
